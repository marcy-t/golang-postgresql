/**
   segmentsテーブル　親テーブル
*/
CREATE TABLE IF NOT EXISTS segments (
    id INTEGER PRIMARY KEY NOT NULL,
    name VARCHAR(40) NOT NULL,
    group_id INTEGER  NOT NULL,
    user_id INTEGER  NOT NULL,
    sex INTEGER NOT NULL REFERENCES sexes(id),
    age_min INTEGER  NOT NULL,
    age_max INTEGER  NOT NULL,
    purchase_condition JSON NOT NULL,
    memo VARCHAR(400)
);

/* Index */
CREATE INDEX idx_segments_group ON segments(group_id);
CREATE INDEX idx_segments_users ON segments(user_id);
CREATE INDEX idx_segments_sex ON segments(sex);


/**
   sum_kaiin
*/
/* DROP TABLE sum_kaiin; */

CREATE TABLE IF NOT EXISTS sum_kaiin (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    prefecture VARCHAR(20)  NOT NULL, 
    uu INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_kaiin_segment_id ON sum_kaiin(segment_id);



/**
   sum_ls
*/
/* DROP TABLE sum_ls; */

CREATE TABLE IF NOT EXISTS sum_ls (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    question_id INTEGER NOT NULL,
    question_name VARCHAR(255) NOT NULL,
    answer_id INTEGER NOT NULL,
    answer_name VARCHAR(255) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_ls_segment_id ON sum_ls(segment_id);


/**
   sum_fm_jicfs
*/
/* DROP TABLE sum_fm_jicfs; */

CREATE TABLE IF NOT EXISTS sum_fm_jicfs (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    daibunrui_cd VARCHAR(100) NOT NULL,
    daibunrui_nm VARCHAR(100) NOT NULL,
    chubunrui_cd VARCHAR(100) NOT NULL,
    chubunrui_nm VARCHAR(100) NOT NULL,
    shobunrui_cd VARCHAR(100) NOT NULL,
    shobunrui_nm VARCHAR(100) NOT NULL,
    saibunrui_cd VARCHAR(100) NOT NULL,
    saibunrui_nm VARCHAR(100) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_fm_jicfs_segment_id ON sum_fm_jicfs(segment_id);


/**
   sum_fm_jicfs_sku
*/
/* DROP TABLE sum_fm_jicfs_sku;*/

CREATE TABLE IF NOT EXISTS sum_fm_jicfs_sku (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    daibunrui_cd VARCHAR(100) NOT NULL,
    daibunrui_nm VARCHAR(100) NOT NULL,
    chubunrui_cd VARCHAR(100) NOT NULL,
    chubunrui_nm VARCHAR(100) NOT NULL,
    shobunrui_cd VARCHAR(100) NOT NULL,
    shobunrui_nm VARCHAR(100) NOT NULL,
    saibunrui_cd VARCHAR(100) NOT NULL,
    saibunrui_nm VARCHAR(100) NOT NULL,
    syohin_nm VARCHAR(255) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_fm_jicfs_sku_segment_id ON sum_fm_jicfs_sku(segment_id);


/**
   sum_tsutaya_book
*/
/* DROP TABLE sum_tsutaya_book; */

CREATE TABLE IF NOT EXISTS sum_tsutaya_book (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    daibunrui_cd VARCHAR(255) NOT NULL,
    daibunrui_nm VARCHAR(255) NOT NULL,
    chubunrui_cd VARCHAR(255) NOT NULL,
    chubunrui_nm VARCHAR(255) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_tsutaya_book_segment_id ON sum_tsutaya_book(segment_id);


/**
   sum_tsutaya_book_sku
*/
/* DROP TABLE sum_tsutaya_book_sku; */

CREATE TABLE IF NOT EXISTS sum_tsutaya_book_sku (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    daibunrui_cd VARCHAR(255) NOT NULL,
    daibunrui_nm VARCHAR(255) NOT NULL,
    chubunrui_cd VARCHAR(255) NOT NULL,
    chubunrui_nm VARCHAR(255) NOT NULL,
    syohin_nm VARCHAR(255) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_tsutaya_book_sku_segment_id ON sum_tsutaya_book_sku(segment_id);



/**
   sum_tsutaya_book_music
*/
/* DROP TABLE sum_tsutaya_book_music; */

CREATE TABLE IF NOT EXISTS sum_tsutaya_book_music (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    daibunrui_cd VARCHAR(255) NOT NULL,
    daibunrui_nm VARCHAR(255) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_tsutaya_book_music_segment_id ON sum_tsutaya_book_music(segment_id);


/**
   sum_tsutaya_book_music_sku
*/
/* DROP TABLE sum_tsutaya_book_music_sku; */

CREATE TABLE IF NOT EXISTS sum_tsutaya_book_music_sku (
    id INTEGER PRIMARY KEY NOT NULL,
    create_at TIMESTAMP WITH TIME zone NOT NULL current_timestamp,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    daibunrui_cd VARCHAR(255) NOT NULL,
    daibunrui_nm VARCHAR(255) NOT NULL,
    artist_nm VARCHAR(255) NOT NULL,
    uu INTEGER  NOT NULL,
    uu_all INTEGER  NOT NULL
);

/* Index */
CREATE INDEX idx_sum_tsutaya_book_music_sku_segment_id ON sum_tsutaya_book_music_sku(segment_id);



/**
   sexes
*/
/* DROP TABLE sexes; */

CREATE TABLE IF NOT EXISTS sexes (
    id INTEGER PRIMARY KEY NOT NULL,
    name VARCHAR(40) UNIQUE NOT NULL
);


/**
   bunrui_types
*/
/* DROP TABLE bunrui_types; */

CREATE TABLE IF NOT EXISTS bunrui_types (
    id INTEGER PRIMARY KEY NOT NULL,
    name VARCHAR(100) UNIQUE NOT NULL
);


/**
   segment_ids
*/
/* DROP TABLE segment_ids; */

CREATE TABLE IF NOT EXISTS segment_ids (
    segment_id INTEGER REFERENCES segments(id),
    id VARCHAR(40) NOT NULL
);

/* Index */
CREATE INDEX idx_segment_ids_segment_id ON segment_ids(segment_id);



/**
   segment_jans
*/
/* DROP TABLE segment_jans; */

CREATE TABLE IF NOT EXISTS segment_jans (
    segment_id INTEGER REFERENCES segments(id),
    jan VARCHAR(40) NOT NULL
);

/* Index */
CREATE INDEX idx_segment_jans_segment_id ON segment_jans(segment_id);



/**
   jobs
*/
/* DROP TABLE jobs; */

CREATE TYPE ENUM AS ENUM ('作成待ち', '作成中', '完了', '取り消し');
CREATE TABLE IF NOT EXISTS jobs (
    id INTEGER PRIMARY KEY NOT NULL,
    name VARCHAR(40) NOT NULL,
    group_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP WITH TIME zone NOT NULL,
    job_finished_at TIMESTAMP NOT NULL,
    job_status ENUM NOT NULL,
    auto_flg BOOLEAN NOT NULL
);

/* Index */
CREATE INDEX idx_jobs_groups ON jobs(group_id);
CREATE INDEX idx_jobs_users ON jobs(user_id);



/**
   job_segments
*/
/* DROP TABLE job_segments; */

CREATE TABLE IF NOT EXISTS job_segments (
    job INTEGER REFERENCES jobs(id) NOT NULL,
    segment_id INTEGER REFERENCES segments(id) NOT NULL,
    sort INTEGER NOT NULL
);

/* Index */
CREATE INDEX idx_job_segments_job ON job_segments(job);
CREATE INDEX idx_job_segments_segment ON job_segments(segment_id);



/**
   report_types
*/
/* DROP TABLE report_types; */

CREATE TABLE IF NOT EXISTS report_types (
    id INTEGER PRIMARY KEY NOT NULL,
    name VARCHAR(255) UNIQUE NOT NULL
);



/**
   job_report_types
*/
/* DROP TABLE job_report_types; */

CREATE TABLE IF NOT EXISTS job_report_types (
    id INTEGER REFERENCES jobs(id) NOT NULL,
    report_type INTEGER REFERENCES report_types(id) NOT NULL
);


# Index
CREATE INDEX idx_job_report_types_id ON job_report_types(id);
CREATE INDEX idx_job_report_types_name ON job_report_types(report_type);

